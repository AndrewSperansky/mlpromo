# üéØ –ë–æ–ª—å—à–æ–π –∏—Ç–æ–≥:

# üìå DEV

—á–∏—Ç–∞–µ–º –ª–æ–≥–∏ –ø—Ä—è–º–æ –∏–∑ logs/‚Ä¶
–∏—Å–ø–æ–ª—å–∑—É–µ–º tail -f, VSCode, —Ñ–∏–ª—å—Ç—Ä—ã

# üìå PROD

–ø–∏—à–µ–º –≤ Docker volume /app/logs
–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º Console transport
–ø–æ–¥–∫–ª—é—á–∞–µ–º Loki –∏–ª–∏ ELK (–≥–æ—Ç–æ–≤–ª—é –∫–æ–Ω—Ñ–∏–≥ –ø–æ –∑–∞–ø—Ä–æ—Å—É)

# üìå –ü—Ä–∞–≤–∏–ª–∞

–ø–æ—Ç–æ–∫–æ–≤—ã–µ –ª–æ–≥–∏ ‚Üí –≤ —Ñ–∞–π–ª
–≤–∞–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ ‚Üí PostgreSQL
GraphQL ‚Üí JSON —Ñ–∞–π–ª
HTTP ‚Üí –æ–±—ã—á–Ω—ã–µ .log


## ‚úî Loki ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤
## ‚úî Promtail ‚Äî –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤ –∏–∑ ./logs –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
## ‚úî Grafana ‚Äî –º–æ—â–Ω—ã–π UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤
## ‚úî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –∏ –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ª–æ–≥–æ–≤


–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
3dsonet/
 ‚îú‚îÄ logs/                                # ‚Üê Winston –ø–∏—à–µ—Ç —Å—é–¥–∞
 ‚îú‚îÄ docker-compose.yml                    # ‚Üê –¥–æ–±–∞–≤–∏–º Loki + Promtail + Grafana
 ‚îú‚îÄ promtail-config.yml                   # ‚Üê –∫–æ–Ω—Ñ–∏–≥ Promtail


## –ö–ê–ö –ó–ê–ô–¢–ò –≤ Grafana
================================

### –ü–æ—Å–ª–µ docker compose up -d:

## Grafana:

üëâ http://localhost:3001

login: admin
password: admin

### Grafana –ø–æ–ø—Ä–æ—Å–∏—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å ‚Äî –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–∂–Ω–∏–π.


## –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Loki –≤–Ω—É—Ç—Ä–∏ Grafana
========================================

### –í Grafana ‚Üí Connections ‚Üí Loki

## URL:
http://loki:3100

### –°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí Explore ‚Üí Logs

### –î–∞–ª—å—à–µ —Ç—ã —É–≤–∏–¥–∏—à—å:

job = 3dsonet
job = graphql

–∏ —Å–º–æ–∂–µ—à—å —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤—Å—ë —á—Ç–æ —É–≥–æ–¥–Ω–æ.


#### üéâ –°—Ç–µ–∫ –≥–æ—Ç–æ–≤!

#### –¢—ã –ø–æ–ª—É—á–∞–µ—à—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é production-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

## ‚úî Winston ‚Üí local files
## ‚úî Docker volume ‚Üí Promtail
## ‚úî Promtail ‚Üí Loki
## ‚úî Loki ‚Üí Grafana

===================================================================================================


## –õ–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

docker logs loki
docker logs promtail
docker logs grafana


## –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:

docker compose stop loki
docker compose rm -f loki
docker compose up -d loki


## –ø–æ–¥–Ω—è—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ volume Loki –≤—Ä—É—á–Ω—É—é

### –í—ã–ø–æ–ª–Ω–∏—Ç—å:

docker exec -it loki sh
chmod -R 777 /loki
exit

### –ù–æ —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ Loki —Ö–æ—Ç—å –Ω–µ–º–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç.


# –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Loki —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –û—Ç–∫—Ä–æ–π —ç—Ç–∏ URL:

## 1Ô∏è‚É£ Build info
http://localhost:3100/loki/api/v1/status/buildinfo

## 2Ô∏è‚É£ Ready
http://localhost:3100/ready

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
http://localhost:3100/config

## 3Ô∏è‚É£ –ú–µ—Ç—Ä–∏–∫–∏
http://localhost:3100/metrics


### –ï—Å–ª–∏ –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö URL –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç JSON –∏–ª–∏ —Ç–µ–∫—Å—Ç ‚Äî Loki —Ä–∞–±–æ—Ç–∞–µ—Ç.

===================================================================

## 1Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å –≤ Explore (UI GRAFANA):
{job=~".+"}
{job="3dsonet"}
{job="graphql"}


## 2Ô∏è‚É£ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Promtail:
docker exec -it promtail ls -lR /app/logs

## –ü—Ä–æ–≤–µ—Ä–∫–∞ Promtail –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
### –í–∏–¥–∏—Ç –ª–∏ Promtail —Ñ–∞–π–ª—ã –ª–æ–≥–æ–≤

docker exec -it promtail ls -lR /app/logs

docker exec -it promtail ls -l /app/logs


## –£ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –ª–æ–≥–∏ –≤ /app/logs?

### –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä 3dsonet-app:

docker exec -it 3dsonet-app sh
ls -R /app/logs



## –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–¥—É—Ç –ª–∏ —Å—Ç—Ä–∏–º—ã –≤ Loki

http://localhost:3100/loki/api/v1/labels


## –ü—Ä–æ–≤–µ—Ä—è–µ–º Promtail

docker logs promtail --tail=200


### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PROMTAIL

docker logs promtail --tail=100

#### –ï—Å–ª–∏ Promtail –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Loki ‚Äî –ª–æ–≥–∏ –Ω–µ –ø–æ—è–≤—è—Ç—Å—è –≤ Grafana.

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å  –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ Docker Desktop

`docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Image}}"`

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞–∑–≤–∞–Ω–∏–µ

`docker volume ls`

### –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
`docker volume rm docker_postgres_data`

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

`docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" `


### –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ promtail:

`docker logs promo_promtail`


### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ª–æ–≥–∏ –ø–æ–ø–∞–¥–∞—é—Ç:

http://localhost:3100/ready
http://localhost:3100/metrics


### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Grafana:

http://localhost:3000

`login: admin / admin`

